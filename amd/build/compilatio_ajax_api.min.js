define(["jquery"],function(i){function o(){i(".compilatio-button").each(function(){i(this).attr("disabled","disabled"),i(this).addClass("disabled"),i(this).attr("href","#")})}var t={},a=t.getIndexingState=function(o,t,a,s){i(document).ready(function(){i.post(o+"/plagiarism/compilatio/ajax/get_indexing_state.php",{idDoc:a,apiconfigid:s},function(n){i(".compi-"+t+" .compilatio-library").detach(),i(".compi-"+t).prepend(n),setTimeout(function(){i(".compi-"+t+" > div:first-child").click(function(){c(o,t,a,s)})},250)})})},c=t.toggleIndexingState=function(o,t,c,s){var n;i(".compi-"+t+" > div:first-child").is(".compilatio-library-in")&&(i(".compi-"+t+" > div:first-child").removeClass("compilatio-library-in"),n=0),i(".compi-"+t+" > div:first-child").is(".compilatio-library-out")&&(i(".compi-"+t+" > div:first-child").removeClass("compilatio-library-out"),n=1),i(".compi-"+t+" > div:first-child").addClass("compilatio-library"),i.post(o+"/plagiarism/compilatio/ajax/set_indexing_state.php",{idDoc:c,indexingState:n,apiconfigid:s},function(i){"true"==i&&a(o,t,c,s)})};return t.refreshButton=function(t,a,c,s){i(document).ready(function(){var n=a.length,e=0,l=i("i.fa-refresh").parent("button");0==n?(o(),c>0&&i(".comp-start-btn").each(function(){i(this).removeAttr("disabled"),i(this).removeClass("disabled")}),i(".comp-restart-btn").removeAttr("disabled"),i(".comp-restart-btn").removeClass("disabled")):l.click(function(){o(),i("#compi-home").html("<p>"+s+"<progress id='compi-update-progress' value='"+e+"' max='"+n+"'></progress></p>"),i("#compilatio-logo").click(),a.forEach(function(o){i.post(t+"/plagiarism/compilatio/ajax/compilatio_check_analysis.php",{id:o},function(){e++,i("#compi-update-progress").val(e),e==n&&window.location.reload()})})})})},t.startAllAnalysis=function(t,a,c,s){i(document).ready(function(){i("button.comp-start-btn").click(function(){o(),i("#compi-notifications").show(),i("#compi-stats, #compi-help, #compi-home, #compi-search").hide(),i("#compi-notif-title").after("<div class='compilatio-alert compilatio-alert-info'><strong>"+c+"</strong><br/>"+s+"</div>"),i.post(t+"/plagiarism/compilatio/ajax/compilatio_start_all_analysis.php",{cmid:a},function(){window.location.reload()})})})},t.startAnalysis=function(o,t,a){i(document).ready(function(){setTimeout(function(){let c=i(".compi-"+t+" > div:last-child");c.click(function(){i.post(o+"/plagiarism/compilatio/ajax/compilatio_start_analysis.php",{docId:a},function(o){"false"!=o&&(o.startsWith("<p")?(i("#cmp-start-analyse-error").remove(),c.closest(".compilatio-area").after(o)):c.replaceWith(o))})})},300)})},t.restartFailedAnalysis=function(t,a,c,s){i(document).ready(function(){i("button.comp-restart-btn").click(function(){o(),i("#compi-notifications").show(),i("#compi-stats, #compi-help, #compi-home, #compi-search").hide(),i("#compi-notif-title").after("<div class='compilatio-alert compilatio-alert-info'><strong>"+c+"</strong><br/>"+s+"</div>"),i.post(t+"/plagiarism/compilatio/ajax/compilatio_reset_failed_document.php",{cmid:a},function(){window.location.reload()})})})},t.compilatioTabs=function(o,t){i(document).ready(function(){i(".moove.secondary-navigation")[0]&&(i("#compilatio-container").css("margin-top","140px"),i("#cmp-display-frame").css("margin-top","140px")),i(".cmp-md").each(function(){i(this).html("<i class='fa-lg fa fa-info-circle'></i><span>"+markdown(i.trim(i(this).text()))+"</span>")}),0==localStorage.getItem("compilatio-container-displayed")&&(i("#compilatio-container").hide(),i("#cmp-display-frame").show()),o>0&&i("#cmp-bell").show(),i("#cmp-display-frame").on("click",function(){localStorage.setItem("compilatio-container-displayed",1),i(this).hide(),i("#compilatio-container").show()}),i("#cmp-hide-frame").on("click",function(){localStorage.setItem("compilatio-container-displayed",0),i("#compilatio-container").hide(),i("#cmp-display-frame").show()}),i("#compilatio-tabs").show();var a="";i(a=t?"#compi-search":"#compi-home").show(),i("#compilatio-show-notifications").on("click",function(){n(i(this),i("#compi-notifications"))}),i("#show-stats").on("click",function(){n(i(this),i("#compi-stats"))}),i("#show-help").on("click",function(){n(i(this),i("#compi-help"))}),i("#show-search").on("click",function(){n(i(this),i("#compi-search"))});var c=i("#compilatio-show-notifications, #show-stats, #show-help, #show-search"),s=i("#compi-notifications, #compi-stats, #compi-help, #compi-home, #compi-search");function n(i,o){o.is(":visible")||(o.show(),s.not(o).hide(),c.not(i).removeClass("active"),i.toggleClass("active"))}i("#compilatio-logo").on("click",function(){var o=i("#compi-home");o.show(),s.not(o).hide(),c.removeClass("active")})})},t});