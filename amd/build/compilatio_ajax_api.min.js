define(["jquery"],function($){function b(){$(".compilatio-button").each(function(){$(this).attr("disabled","disabled"),$(this).addClass("disabled"),$(this).attr("href","#")})}var a={},c=a.getIndexingState=function(a,b,c,e){$(document).ready(function(){$.post(a+"/plagiarism/compilatio/ajax/get_indexing_state.php",{idDoc:c,apiconfigid:e},function(f){$(".compi-"+b+" .compilatio-library").detach(),$(".compi-"+b).prepend(f),setTimeout(function(){$(".compi-"+b+" > div:first-child").click(function(){d(a,b,c,e)})},250)})})},d=a.toggleIndexingState=function(d,a,e,f){var b;$(".compi-"+a+" > div:first-child").is(".compilatio-library-in")&&($(".compi-"+a+" > div:first-child").removeClass("compilatio-library-in"),b=0),$(".compi-"+a+" > div:first-child").is(".compilatio-library-out")&&($(".compi-"+a+" > div:first-child").removeClass("compilatio-library-out"),b=1),$(".compi-"+a+" > div:first-child").addClass("compilatio-library"),$.post(d+"/plagiarism/compilatio/ajax/set_indexing_state.php",{idDoc:e,indexingState:b,apiconfigid:f},function(b){"true"==b&&c(d,a,e,f)})};return a.refreshButton=function(a,c,d,e){$(document).ready(function(){var f=c.length,h=0,g=$("i.fa-refresh").parent("button");0==f?(b(),d>0&&$(".comp-start-btn").each(function(){$(this).removeAttr("disabled"),$(this).removeClass("disabled")})):g.click(function(){b(),$("#compi-home").html("<p>"+e+"<progress id='compi-update-progress' value='"+h+"' max='"+f+"'></progress></p>"),$("#compilatio-logo").click(),c.forEach(function(b){$.post(a+"/plagiarism/compilatio/ajax/compilatio_check_analysis.php",{id:b},function(){h++,$("#compi-update-progress").val(h),h==f&&window.location.reload()})})})})},a.startAllAnalysis=function(a,c,d,e){$(document).ready(function(){$("button.comp-start-btn").click(function(){b(),$("#compi-notifications").show(),$("#compi-stats, #compi-help, #compi-home, #compi-search").hide(),$("#compi-notif-title").after("<div class='compilatio-alert compilatio-alert-info'><strong>"+d+"</strong><br/>"+e+"</div>"),$.post(a+"/plagiarism/compilatio/ajax/compilatio_start_all_analysis.php",{cmid:c},function(){window.location.reload()})})})},a.startAnalysis=function(a,b,c){$(document).ready(function(){setTimeout(function(){$(".compi-"+b+" > div:last-child").click(function(){$.post(a+"/plagiarism/compilatio/ajax/compilatio_start_analysis.php",{docId:c},function(){window.location.reload()})})},300)})},a.restartFailedAnalysis=function(a,c,d,e){$(document).ready(function(){$("button.comp-restart-btn").click(function(){b(),$("#compi-notifications").show(),$("#compi-stats, #compi-help, #compi-home, #compi-search").hide(),$("#compi-notif-title").after("<div class='compilatio-alert compilatio-alert-info'><strong>"+d+"</strong><br/>"+e+"</div>"),$.post(a+"/plagiarism/compilatio/ajax/compilatio_reset_failed_document.php",{cmid:c},function(){window.location.reload()})})})},a.startMigration=function(a){$(document).ready(function(){var b=$("#compilatio-startmigration-btn");b.click(async function(){b.attr("disabled","disabled");var c=$("#compilatio-startmigration-info");c.show();var f=$("#apikey").val(),d=0;do{var e=await $.post(a+"/plagiarism/compilatio/ajax/migration.php",{apikey:f,i:d}).promise();0==d&& !0==e?$.get({url:"https://app.compilatio.net/api/private/document/count",headers:{"X-Auth-Token":f}},function(a){$("#migration-progress").html("<progress id='migration-update-progress' value='0' max='"+a.data.count/500+"'></progress>")}):$("#migration-update-progress").val(d),d++}while(!0==e)c.removeClass("alert-info"),e.match("^Error")?c.addClass("alert-danger"):c.addClass("alert-success"),c.html(e)})})},a.compilatioTabs=function(a,b,c,d,e){$(document).ready(function(){$.post(a+"/plagiarism/compilatio/ajax/get_waiting_time.php",{},function(a){if(!1!=a){if(b>0){$("#compi-notif-title").after(a);var f=parseInt($("#count-alerts").text());$("#count-alerts").text(f+1)}else $("#show-stats").after(d),$("#compilatio-tabs").after(e+a+"</div>"),b=1}$("#compilatio-tabs").show();$(c?"#compi-search":b>0?"#compi-notifications":"#compi-home").show(),$("#compilatio-show-notifications").on("click",function(){i($(this),$("#compi-notifications"))}),$("#show-stats").on("click",function(){i($(this),$("#compi-stats"))}),$("#show-help").on("click",function(){i($(this),$("#compi-help"))}),$("#show-search").on("click",function(){i($(this),$("#compi-search"))});var g=$("#compilatio-show-notifications, #show-stats, #show-help, #show-search"),h=$("#compi-notifications, #compi-stats, #compi-help, #compi-home, #compi-search");function i(b,a){a.is(":visible")||(a.show(),h.not(a).hide(),g.not(b).removeClass("active"),b.toggleClass("active"),$("#compilatio-hide-area").fadeIn())}$("#compilatio-logo").on("click",function(){var a=$("#compi-home");a.show(),h.not(a).hide(),g.removeClass("active"),$("#compilatio-hide-area").fadeIn()}),$("#compilatio-hide-area").on("click",function(){h.hide(),$(this).fadeOut(),g.removeClass("active")})})})},a})