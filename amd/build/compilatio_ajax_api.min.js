define(["jquery"],(function(t){function n(){t(".cmp-action-btn").each((function(){t(this).attr("disabled","disabled"),t(this).addClass("disabled"),t(this).attr("href","#")}))}var i={},c=!1;function e(i,c,e,o=null,s=[],a=null){n(),t("#cmp-dropdown-menu").removeClass("show"),t("#cmp-alerts").append("\n                <div class='cmp-alert cmp-alert-info'>"+i+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>");let r={cmid:e,selectedquestions:s,quizid:a};null!==o&&(r.selectedstudents=o.toString()),t.post(c+"/plagiarism/compilatio/ajax/start_multiple_analyses.php",r,(function(){window.location.reload()}))}function o(n,i,e,o,s,a,r,l){t.post(n+"/plagiarism/compilatio/ajax/display_document_frame.php",{cantriggeranalysis:i,isstudentanalyse:e,cmpfileid:o,canviewreport:s,isteacher:a,url:r},(function(i){t("#cmp-"+l).empty().append(i),setTimeout((()=>{if(a){var i=t("#cmp-"+l+" .cmp-similarity");i.on("mouseover",(()=>{i.find("i").show(),i.find("span").hide()})),i.on("mouseout",(()=>{i.find("i").hide(),i.find("span").show()})),i.click((function(){c||(t("#cmp-"+l+" #cmp-score-icons").remove(),i.empty(),t.post(n+"/plagiarism/compilatio/ajax/update_score.php",{docId:o},(function(t){i.replaceWith(t)})))}))}t("#cmp-"+l+" .cmp-library").click((function(){if(!c){var i=t(this).find("i"),e=i.is(".cmp-library-in")?0:1;i.removeClass(),i.parent().attr("title",""),t.post(n+"/plagiarism/compilatio/ajax/set_indexing_state.php",{docId:o,indexingState:e},(function(t){let n=JSON.parse(t);"ok"===n.status&&(0===e?i.addClass("cmp-library-out fa-times-circle fa"):i.addClass("cmp-library-in fa-check-circle fa"),i.parent().attr("title",n.text))}))}}));var e=t("#cmp-"+l+" .cmp-start-btn");e.click((function(){c||(e.find("i").removeClass("fa-play-circle").addClass("fa-spinner fa-spin"),t.post(n+"/plagiarism/compilatio/ajax/start_analysis.php",{docId:o},(function(n){"error"in(n=JSON.parse(n))?(t("#cmp-"+l+" p").remove(),t("#cmp-"+l).append("<p class='cmp-color-red'>"+n.error+"</p>"),e.find("i").removeClass("fa-spinner fa-spin").addClass("fa-play-circle")):e.replaceWith(n.documentFrame)})))}))}),500)}))}return t(document).ready((function(){t("#maintenance-modal").length&&(c=!0,n())})),i.getSelectedStudent=function(n,i){t(document).ready((function(){const c=t("#student-select"),e=t("#statistics-container");function o(t,n){var i=t+n;const e=c.find("option").length-1;-1===i?i=e:i>e&&(i=0),c.prop("selectedIndex",i).change()}c.on("change",(function(){const c=t(this).val();t.ajax({type:"POST",url:n+"/plagiarism/compilatio/ajax/stats_per_student.php",data:{selectedstudent:c,cmid:i},success:function(t){e.html(t)},error:function(){e.html('<div class="alert alert-warning">Unable to load statistics.</div>')}})})),t("#previous-student").on("click",(function(){o(c.prop("selectedIndex"),-1)})),t("#next-student").on("click",(function(){o(c.prop("selectedIndex"),1)}))}))},i.startAllAnalysis=function(n,i,c){t(document).ready((function(){t("#cmp-dropdown-menu").on("click",(function(t){t.stopPropagation()})),t(".cmp-start-btn").click((function(){e(c,n,i)}))}))},i.startAnalysesOnSelectedStudents=function(n,i,c){t(document).ready((function(){const o=t("#start-selected-students-btn").hide(),s=t("td.c0 input, #selectall");function a(){return s.filter(":checked").map((function(){return"on"!==t(this).val()?t(this).val():null})).get()}s.on("change",(function(){a().length>0?o.show():o.hide()})),o.click((function(){e(c,n,i,a())}))}))},i.startAnalysesOnSelectedQuestions=function(n,i,c,o){t(document).ready((function(){t("#start-selected-questions-btn").click((function(){var s=t(".checkbox-question-selector:checked"),a=[];s.each((function(){a.push(t(this).val())})),a.length>0&&e(c,n,i,null,a,o)}))}))},i.sendUnsentDocs=function(i,c,e){t(document).ready((function(){t("#cmp-send-btn").click((function(){n(),t("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+e+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),t.post(i+"/plagiarism/compilatio/ajax/send_unsent_docs.php",{cmid:c},(function(){window.location.reload()}))}))}))},i.resetDocsInError=function(i,c,e){t(document).ready((function(){t("#cmp-reset-btn").click((function(){n(),t("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+e+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),t.post(i+"/plagiarism/compilatio/ajax/reset_docs_in_error.php",{cmid:c},(function(){window.location.reload()}))}))}))},i.updateScoreSettings=function(n,i,c){t(document).ready((function(){var e=t("#score-settings-ignored");e.click((function(){e.css("background-color","grey"),e.html('<div class="spinner-border spinner-border-sm" role="status">\n                        <span class="sr-only">\n                            Loading...\n                        </span>\n                    </div>'),t(".checkbox-score-settings").attr("disabled",!0);var o=t(".checkbox-score-settings:checked"),s=[];o.each((function(){s.push(t(this).val())})),t.ajax({type:"POST",url:n+"/plagiarism/compilatio/ajax/update_score_settings.php",data:{cmid:i,checkedvalues:s,scores:c},success:function(){let t=new URL(window.location.href);t.searchParams.get("refreshAllDocs")?window.location.reload():(t.searchParams.append("refreshAllDocs","true"),window.location.href=t.href)},error:function(){window.location.reload()}})}))}))},i.checkUserInfo=function(n,i){t(document).ready((function(){t.post(n+"/plagiarism/compilatio/ajax/check_user_info.php",{cmid:i})}))},i.displayDocumentFrame=function(n,i,c,e,s,a,r,l){t(document).ready((function(){o(n,i,c,e,s,a,r,l),setInterval((function(){o(n,i,c,e,s,a,r,l)}),18e4)}))},i.getNotifications=function(n,i){t(document).ready((function(){let c=localStorage.getItem("notifications-read"),e=localStorage.getItem("notifications-ignored");t.post(n+"/plagiarism/compilatio/ajax/get_notifications.php",{userid:i,read:c?JSON.parse(c):[],ignored:e?JSON.parse(e):[]},(function(n){function i(){t(".cmp-alert-notifications").remove(),localStorage.setItem("notifications-ignored",JSON.stringify(n.ids))}n=JSON.parse(n),t("#cmp-count-notifications").html(0===n.count?"":n.count),t("#cmp-notifications").html(n.content),t("#cmp-alerts").append(n.floating),t(".cmp-notifications-title").on("click",(function(){let n=t("#cmp-count-notifications").html();n--,t("#cmp-count-notifications").html(n<=0?"":n),i(),t("#cmp-show-notifications").toggleClass("active"),t("#cmp-notifications").show(),t("#cmp-notifications-titles").hide();let c=t(this).attr("id").split("-").pop();t("#cmp-notifications-content-"+c).show(),t("#cmp-notifications-"+c).children().first().removeClass("text-primary");let e=localStorage.getItem("notifications-read");e=e?JSON.parse(e):[],e.includes(c)||(e.push(c),localStorage.setItem("notifications-read",JSON.stringify(e)))})),t(".cmp-show-notifications").on("click",(function(){t("#cmp-notifications-titles").show(),t(".cmp-notifications-content").hide()})),t("#cmp-ignore-notifications").on("click",(function(){i()})),t("#cmp-show-notifications").on("click",(function(){i()}))}))}))},i.compilatioTabs=function(n){t(document).ready((function(){t(".moove.secondary-navigation")[0]&&t("#cmp-container").css("margin-top","140px"),t(".cmp-md").each((function(){var n=t.trim(t(this).text()).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>').replace(/\n/g,"<br>");t(this).html(n)})),t("#cmp-tabs").show(),t("#cmp-alerts > .cmp-alert > .fa-times").on("click",(function(){t("#cmp-alert-"+t(this).attr("id").split("-").pop()).parent().remove()})),n&&t("#cmp-search").show(),t("#cmp-show-notifications").on("click",(function(){e(t(this),t("#cmp-notifications"))})),t("#show-stats").on("click",(function(){e(t(this),t("#cmp-stats"))})),t("#show-stats-per-student").on("click",(function(){e(t(this),t("#cmp-stats-per-student"))})),t("#show-help").on("click",(function(){e(t(this),t("#cmp-help"))})),t("#show-search").on("click",(function(){e(t(this),t("#cmp-search"))})),t("#cmp-show-settings").on("click",(function(){e(t(this),t("#cmp-settings"))}));var i=t("#cmp-show-notifications,\n                #show-stats,\n                #show-stats-per-student,\n                #show-help,\n                #show-search,\n                #cmp-show-settings"),c=t("#cmp-notifications,\n                #cmp-stats,\n                #cmp-stats-per-student,\n                #cmp-help,\n                #cmp-search,\n                #cmp-settings");function e(n,e){e.is(":visible")?(c.hide(),i.removeClass("active")):(e.show(),c.not(e).hide(),i.not(n).removeClass("active"),n.toggleClass("active")),t("#show-stats").hasClass("active")&&t("#cmp-container").css("max-width","none")}t("#cmp-logo").on("click",(function(){c.hide(),i.removeClass("active")}))}))},i}));