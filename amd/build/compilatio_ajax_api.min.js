define(["jquery"],function(t){function i(){t(".cmp-action-btn").each(function(){t(this).attr("disabled","disabled"),t(this).addClass("disabled"),t(this).attr("href","#")})}var n={};function c(n,c,s,e=null,o=[],a=null){i(),t("#cmp-dropdown-menu").removeClass("show"),t("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+n+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>");let r={cmid:s,selectedquestions:o,quizid:a};null!=e&&(r.selectedstudents=e.toString()),t.post(c+"/plagiarism/compilatio/ajax/start_multiple_analyses.php",r,function(){window.location.reload()})}function s(i,n,c,s,e,o,a,r){t.post(i+"/plagiarism/compilatio/ajax/display_document_frame.php",{cantriggeranalysis:n,isstudentanalyse:c,cmpfileid:s,canviewreport:e,isteacher:o,url:a},function(n){t("#cmp-"+r).empty().append(n),setTimeout(n=>{if(o){var c=t("#cmp-"+r+" .cmp-similarity");c.on("mouseover",t=>{c.find("i").show(),c.find("span").hide()}),c.on("mouseout",t=>{c.find("i").hide(),c.find("span").show()}),c.click(function(){t("#cmp-"+r+" #cmp-score-icons").remove(),c.empty(),t.post(i+"/plagiarism/compilatio/ajax/update_score.php",{docId:s},function(t){c.replaceWith(t)})})}t("#cmp-"+r+" .cmp-library").click(function(){var n=t(this).find("i");if(n.is(".cmp-library-in"))var c=0;if(n.is(".cmp-library-out"))var c=1;n.removeClass(),n.parent().attr("title",""),t.post(i+"/plagiarism/compilatio/ajax/set_indexing_state.php",{docId:s,indexingState:c},function(t){"ok"===(response=JSON.parse(t)).status&&(0==c?n.addClass("cmp-library-out fa-times-circle fa"):n.addClass("cmp-library-in fa-check-circle fa"),n.parent().attr("title",response.text))})});var e=t("#cmp-"+r+" .cmp-start-btn");e.click(function(){e.find("i").removeClass("fa-play-circle").addClass("fa-spinner fa-spin"),t.post(i+"/plagiarism/compilatio/ajax/start_analysis.php",{docId:s},function(i){"error"in(i=JSON.parse(i))?(t("#cmp-"+r+" p").remove(),t("#cmp-"+r).append("<p class='cmp-color-red'>"+i.error+"</p>"),e.find("i").removeClass("fa-spinner fa-spin").addClass("fa-play-circle")):e.replaceWith(i.documentFrame)})})},500)})}return n.getSelectedStudent=function(i,n){t(document).ready(function(){let c=t("#student-select"),s=t("#statistics-container");function e(t,i){var n=t+i;let s=c.find("option").length-1;-1==n?n=s:n>s&&(n=0),c.prop("selectedIndex",n).change()}c.on("change",function(){let c=t(this).val();t.ajax({type:"POST",url:i+"/plagiarism/compilatio/ajax/stats_per_student.php",data:{selectedstudent:c,cmid:n},success:function(t){s.html(t)},error:function(t){console.error("Error:",t)}})}),t("#previous-student").on("click",function(){e(c.prop("selectedIndex"),-1)}),t("#next-student").on("click",function(){e(c.prop("selectedIndex"),1)})})},n.startAllAnalysis=function(i,n,s){t(document).ready(function(){t("#cmp-dropdown-menu").on("click",function(t){t.stopPropagation()}),t(".cmp-start-btn").click(function(){c(s,i,n)})})},n.startAnalysesOnSelectedStudents=function(i,n,s){t(document).ready(function(){let e=t("#start-selected-students-btn").hide(),o=t("td.c0 input, #selectall");function a(){return o.filter(":checked").map(function(){return"on"!=t(this).val()?t(this).val():null}).get()}o.on("change",function t(){let i=a();i.length>0?e.show():e.hide()}),e.click(function(){c(s,i,n,a())})})},n.startAnalysesOnSelectedQuestions=function(i,n,s,e){t(document).ready(function(){let o=t("#start-selected-questions-btn");o.click(function(){var o=t(".checkbox-question-selector:checked"),a=[];o.each(function(){a.push(t(this).val())}),a.length>0&&c(s,i,n,null,a,e)})})},n.sendUnsentDocs=function(n,c,s){t(document).ready(function(){t("#cmp-send-btn").click(function(){i(),t("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+s+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),t.post(n+"/plagiarism/compilatio/ajax/send_unsent_docs.php",{cmid:c},function(){window.location.reload()})})})},n.resetDocsInError=function(n,c,s){t(document).ready(function(){t("#cmp-reset-btn").click(function(){i(),t("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+s+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),t.post(n+"/plagiarism/compilatio/ajax/reset_docs_in_error.php",{cmid:c},function(){window.location.reload()})})})},n.updateScoreSettings=function(i,n,c){t(document).ready(function(){var s=t("#score-settings-ignored");s.click(function(){s.css("background-color","grey"),s.html('<div class="spinner-border spinner-border-sm" role="status"><span class="sr-only">Loading...</span></div>'),t(".checkbox-score-settings").attr("disabled",!0);var e=t(".checkbox-score-settings:checked"),o=[];e.each(function(){o.push(t(this).val())}),t.ajax({type:"POST",url:i+"/plagiarism/compilatio/ajax/update_score_settings.php",data:{cmid:n,checkedvalues:o,scores:c},success:function(){let t=new URL(window.location.href);t.searchParams.get("refreshAllDocs")?window.location.reload():(t.searchParams.append("refreshAllDocs","true"),window.location.href=t.href)},error:function(t){console.error("Error:",t)}})})})},n.checkUserInfo=function(i,n){t(document).ready(function(){t.post(i+"/plagiarism/compilatio/ajax/check_user_info.php",{userid:n})})},n.displayDocumentFrame=function(i,n,c,e,o,a,r,p){t(document).ready(function(){s(i,n,c,e,o,a,r,p),setInterval(function(){s(i,n,c,e,o,a,r,p)},18e4)})},n.getNotifications=function(i,n){t(document).ready(function(){let c=localStorage.getItem("notifications-read"),s=localStorage.getItem("notifications-ignored");t.post(i+"/plagiarism/compilatio/ajax/get_notifications.php",{userid:n,read:c?JSON.parse(c):[],ignored:s?JSON.parse(s):[]},function(i){function n(){t(".cmp-alert-notifications").remove(),localStorage.setItem("notifications-ignored",JSON.stringify(i.ids))}i=JSON.parse(i),t("#cmp-count-notifications").html(0==i.count?"":i.count),t("#cmp-notifications").html(i.content),t("#cmp-alerts").append(i.floating),t(".cmp-notifications-title").on("click",function(){let i=t("#cmp-count-notifications").html();i--,t("#cmp-count-notifications").html(i<=0?"":i),n(),t("#cmp-show-notifications").toggleClass("active"),t("#cmp-notifications").show(),t("#cmp-notifications-titles").hide();let c=t(this).attr("id").split("-").pop();t("#cmp-notifications-content-"+c).show(),t("#cmp-notifications-"+c).children().first().removeClass("text-primary");let s=localStorage.getItem("notifications-read");s&&JSON.parse(s),s.includes(c)||(s.push(c),localStorage.setItem("notifications-read",JSON.stringify(s)))}),t(".cmp-show-notifications").on("click",function(){t("#cmp-notifications-titles").show(),t(".cmp-notifications-content").hide()}),t("#cmp-ignore-notifications").on("click",function(){n()}),t("#cmp-show-notifications").on("click",function(){n()})})})},n.compilatioTabs=function(i){t(document).ready(function(){t(".moove.secondary-navigation")[0]&&t("#cmp-container").css("margin-top","140px"),t(".cmp-md").each(function(){t(this).html(markdown(t.trim(t(this).text())))}),t("#cmp-tabs").show(),t("#cmp-alerts > .cmp-alert > .fa-times").on("click",function(){t("#cmp-alert-"+t(this).attr("id").split("-").pop()).parent().remove()}),i&&t("#cmp-search").show(),t("#cmp-show-notifications").on("click",function(){s(t(this),t("#cmp-notifications"))}),t("#show-stats").on("click",function(){s(t(this),t("#cmp-stats"))}),t("#show-stats-per-student").on("click",function(){s(t(this),t("#cmp-stats-per-student"))}),t("#show-help").on("click",function(){s(t(this),t("#cmp-help"))}),t("#show-search").on("click",function(){s(t(this),t("#cmp-search"))}),t("#cmp-show-settings").on("click",function(){s(t(this),t("#cmp-settings"))});var n=t("#cmp-show-notifications, #show-stats, #show-stats-per-student, #show-help, #show-search, #cmp-show-settings"),c=t("#cmp-notifications, #cmp-stats, #cmp-stats-per-student, #cmp-help, #cmp-search, #cmp-settings");function s(i,s){s.is(":visible")?(c.hide(),n.removeClass("active")):(s.show(),c.not(s).hide(),n.not(i).removeClass("active"),i.toggleClass("active")),t("#show-stats").hasClass("active")&&t("#cmp-container").css("max-width","none")}t("#cmp-logo").on("click",function(){c.hide(),n.removeClass("active")})})},n});